{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n  var options = rfcString.split('\\n').map(parseLine).filter(function (x) {\n    return x !== null;\n  });\n  return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n  var options = {};\n  var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n\n  if (!dtstartWithZone) {\n    return options;\n  }\n\n  var _ = dtstartWithZone[0],\n      tzid = dtstartWithZone[1],\n      dtstart = dtstartWithZone[2];\n\n  if (tzid) {\n    options.tzid = tzid;\n  }\n\n  options.dtstart = dateutil.untilStringToDate(dtstart);\n  return options;\n}\n\nfunction parseLine(rfcString) {\n  rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n  if (!rfcString.length) return null;\n  var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n\n  if (!header) {\n    return parseRrule(rfcString);\n  }\n\n  var _ = header[0],\n      key = header[1];\n\n  switch (key.toUpperCase()) {\n    case 'RRULE':\n    case 'EXRULE':\n      return parseRrule(rfcString);\n\n    case 'DTSTART':\n      return parseDtstart(rfcString);\n\n    default:\n      throw new Error(\"Unsupported RFC prop \" + key + \" in \" + rfcString);\n  }\n}\n\nfunction parseRrule(line) {\n  var strippedLine = line.replace(/^RRULE:/i, '');\n  var options = parseDtstart(strippedLine);\n  var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n  attrs.forEach(function (attr) {\n    var _a = attr.split('='),\n        key = _a[0],\n        value = _a[1];\n\n    switch (key.toUpperCase()) {\n      case 'FREQ':\n        options.freq = Frequency[value.toUpperCase()];\n        break;\n\n      case 'WKST':\n        options.wkst = Days[value.toUpperCase()];\n        break;\n\n      case 'COUNT':\n      case 'INTERVAL':\n      case 'BYSETPOS':\n      case 'BYMONTH':\n      case 'BYMONTHDAY':\n      case 'BYYEARDAY':\n      case 'BYWEEKNO':\n      case 'BYHOUR':\n      case 'BYMINUTE':\n      case 'BYSECOND':\n        var num = parseNumber(value);\n        var optionKey = key.toLowerCase(); // @ts-ignore\n\n        options[optionKey] = num;\n        break;\n\n      case 'BYWEEKDAY':\n      case 'BYDAY':\n        options.byweekday = parseWeekday(value);\n        break;\n\n      case 'DTSTART':\n      case 'TZID':\n        // for backwards compatibility\n        var dtstart = parseDtstart(line);\n        options.tzid = dtstart.tzid;\n        options.dtstart = dtstart.dtstart;\n        break;\n\n      case 'UNTIL':\n        options.until = dateutil.untilStringToDate(value);\n        break;\n\n      case 'BYEASTER':\n        options.byeaster = Number(value);\n        break;\n\n      default:\n        throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n    }\n  });\n  return options;\n}\n\nfunction parseNumber(value) {\n  if (value.indexOf(',') !== -1) {\n    var values = value.split(',');\n    return values.map(parseIndividualNumber);\n  }\n\n  return parseIndividualNumber(value);\n}\n\nfunction parseIndividualNumber(value) {\n  if (/^[+-]?\\d+$/.test(value)) {\n    return Number(value);\n  }\n\n  return value;\n}\n\nfunction parseWeekday(value) {\n  var days = value.split(',');\n  return days.map(function (day) {\n    if (day.length === 2) {\n      // MO, TU, ...\n      return Days[day]; // wday instanceof Weekday\n    } // -1MO, +3FR, 1SO, 13TU ...\n\n\n    var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n    var n = Number(parts[1]);\n    var wdaypart = parts[2];\n    var wday = Days[wdaypart].weekday;\n    return new Weekday(wday, n);\n  });\n}","map":{"version":3,"sources":["../../../src/parsestring.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n    var options = rfcString.split('\\n').map(parseLine).filter(function (x) { return x !== null; });\n    return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n    var options = {};\n    var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n    if (!dtstartWithZone) {\n        return options;\n    }\n    var _ = dtstartWithZone[0], tzid = dtstartWithZone[1], dtstart = dtstartWithZone[2];\n    if (tzid) {\n        options.tzid = tzid;\n    }\n    options.dtstart = dateutil.untilStringToDate(dtstart);\n    return options;\n}\nfunction parseLine(rfcString) {\n    rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n    if (!rfcString.length)\n        return null;\n    var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n    if (!header) {\n        return parseRrule(rfcString);\n    }\n    var _ = header[0], key = header[1];\n    switch (key.toUpperCase()) {\n        case 'RRULE':\n        case 'EXRULE':\n            return parseRrule(rfcString);\n        case 'DTSTART':\n            return parseDtstart(rfcString);\n        default:\n            throw new Error(\"Unsupported RFC prop \" + key + \" in \" + rfcString);\n    }\n}\nfunction parseRrule(line) {\n    var strippedLine = line.replace(/^RRULE:/i, '');\n    var options = parseDtstart(strippedLine);\n    var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n    attrs.forEach(function (attr) {\n        var _a = attr.split('='), key = _a[0], value = _a[1];\n        switch (key.toUpperCase()) {\n            case 'FREQ':\n                options.freq = Frequency[value.toUpperCase()];\n                break;\n            case 'WKST':\n                options.wkst = Days[value.toUpperCase()];\n                break;\n            case 'COUNT':\n            case 'INTERVAL':\n            case 'BYSETPOS':\n            case 'BYMONTH':\n            case 'BYMONTHDAY':\n            case 'BYYEARDAY':\n            case 'BYWEEKNO':\n            case 'BYHOUR':\n            case 'BYMINUTE':\n            case 'BYSECOND':\n                var num = parseNumber(value);\n                var optionKey = key.toLowerCase();\n                // @ts-ignore\n                options[optionKey] = num;\n                break;\n            case 'BYWEEKDAY':\n            case 'BYDAY':\n                options.byweekday = parseWeekday(value);\n                break;\n            case 'DTSTART':\n            case 'TZID':\n                // for backwards compatibility\n                var dtstart = parseDtstart(line);\n                options.tzid = dtstart.tzid;\n                options.dtstart = dtstart.dtstart;\n                break;\n            case 'UNTIL':\n                options.until = dateutil.untilStringToDate(value);\n                break;\n            case 'BYEASTER':\n                options.byeaster = Number(value);\n                break;\n            default:\n                throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n        }\n    });\n    return options;\n}\nfunction parseNumber(value) {\n    if (value.indexOf(',') !== -1) {\n        var values = value.split(',');\n        return values.map(parseIndividualNumber);\n    }\n    return parseIndividualNumber(value);\n}\nfunction parseIndividualNumber(value) {\n    if (/^[+-]?\\d+$/.test(value)) {\n        return Number(value);\n    }\n    return value;\n}\nfunction parseWeekday(value) {\n    var days = value.split(',');\n    return days.map(function (day) {\n        if (day.length === 2) {\n            // MO, TU, ...\n            return Days[day]; // wday instanceof Weekday\n        }\n        // -1MO, +3FR, 1SO, 13TU ...\n        var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n        var n = Number(parts[1]);\n        var wdaypart = parts[2];\n        var wday = Days[wdaypart].weekday;\n        return new Weekday(wday, n);\n    });\n}\n//# sourceMappingURL=parsestring.js.map"]},"metadata":{},"sourceType":"module"}